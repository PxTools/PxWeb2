<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Pxweb2</title>
    <base href="/" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" type="image/svg+xml" href="./images/favicon.svg" />
    <link
      rel="icon"
      type="image/svg+xml"
      media="(prefers-color-scheme: dark)"
      href="./images/favicon-darkmode.svg"
    />
    <link rel="stylesheet" href="src/styles.scss" />
    <link rel="stylesheet" href="./theme/variables.css?v=__BUILD_DATE__" />
    <link
      rel="preload"
      href="./fonts/PxWeb-font-500.ttf"
      as="font"
      crossorigin="anonymous"
      type="font/ttf"
    />
    <link
      rel="preload"
      href="./fonts/PxWeb-font-500-Italic.ttf"
      as="font"
      crossorigin="anonymous"
      type="font/ttf"
    />
    <link
      rel="preload"
      href="./fonts/PxWeb-font-700.ttf"
      as="font"
      crossorigin="anonymous"
      type="font/ttf"
    />
    <link
      rel="preload"
      href="./fonts/PxWeb-font-700-Italic.ttf"
      as="font"
      crossorigin="anonymous"
      type="font/ttf"
    />
    <link
      rel="preload"
      href="./fonts/PxWeb-font-400.ttf"
      as="font"
      crossorigin="anonymous"
      type="font/ttf"
    />
    <link
      rel="preload"
      href="./fonts/PxWeb-font-400-Italic.ttf"
      as="font"
      crossorigin="anonymous"
      type="font/ttf"
    />
    <style>
      .oldLinkClass {
        display: block;
        background-color: #c3e6fe;
        width: 100%;
        font-family: 'PxWeb-font';
        padding: 10px 0 10px 30px;
      }
    </style>
    <script src="./config/config.js?v=__BUILD_DATE__"></script>

    <script type="module">
      /**
       * Fires update() on initial load and on every SPA navigation:
       * - history.pushState / replaceState (programmatic navigation)
       * - popstate (back/forward)
       */
      (function () {
        function computeTransformedUrl() {
          const url = new URL(window.location.href);
          const newUrl = url.pathname.replace('/statbank2/', '/statbank/');
          // Swap only the first path segment: /mypath1/... -> /mypath2/...
          // const parts = url.pathname.split('/'); // ["", "mypath1", "table", "mytable"]
          // if (parts[1] === 'statbank2') {
          //   parts[1] = 'statbank';
          //   url.pathname = parts.join('/');
          // }
          // return url.toString();
          return newUrl.toString();
        }

        function update() {
          const newUrl = computeTransformedUrl();

          // Update your link and/or text if they exist (outside React root or accessible)
          const link = document.getElementById('myLink');
          if (link) link.href = newUrl;

          // const out = document.getElementById('mytext');
          // if (out) out.textContent = newUrl;
        }

        // Patch pushState / replaceState to emit a custom event
        ['pushState', 'replaceState'].forEach((method) => {
          const original = history[method];
          history[method] = function () {
            const ret = original.apply(this, arguments);
            window.dispatchEvent(new Event('rr-nav')); // custom event for SPA navigation
            return ret;
          };
        });

        // Listen for both our custom event and browser back/forward
        window.addEventListener('rr-nav', update);
        window.addEventListener('popstate', update);

        // Initial run after DOM is ready
        document.addEventListener('DOMContentLoaded', update);
      })();
    </script>

    <!-- <script type="module">
      // Vite uses ES modules; DOMContentLoaded

      document.addEventListener('DOMContentLoaded', () => {
        const url = new URL(window.location.href);
        //url.pathname = url.pathname.replace('/statbank2/', '/statbank/');
        url.pathname = url.pathname.replace(
          /^\/statbank2(?=\/|$)/,
          '/statbank',
        );
        const origin = window.location.origin;
        const { pathname, search, hash } = window.location;
        const absoluteUrl = origin + pathname + search + hash;
        alert(absoluteUrl);
        const link = document.getElementById('myLink');
        if (link) {
          link.href = absoluteUrl.toString();
        }
      });
    </script> -->
  </head>

  <body>
    <div id="mytext">
      <a id="myLink" class="oldLinkClass" href=""
        >Lenkte til samme tabell i gammel versjon av pxweb</a
      >
    </div>
    <div id="root"></div>

    <script type="module" src="src/main.tsx"></script>
  </body>
</html>
